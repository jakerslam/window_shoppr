FROM node:22-alpine AS base

WORKDIR /app

# Install only what the API server needs at runtime.
# Note: the repo currently has a single package.json (Next.js + API), so deps include Next.
COPY package.json package-lock.json ./
RUN npm ci --omit=dev

# Copy only server + DB schema/seeds + JSON catalog (optional dev seed).
COPY server ./server
COPY db ./db
COPY src/data ./src/data

ENV NODE_ENV=production
ENV WINDOW_SHOPPR_API_PORT=8787

EXPOSE 8787

CMD ["node", "server/index.mjs"]

